{
  "openapi": "3.0.0",
  "info": {
    "title": "Application Programming Interface",
    "version": "1.0.0"
  },
  "paths": {
    "/auth/login": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Generate new refresh token for a user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": {
                    "type": "string",
                    "example": "44702311"
                  }
                },
                "required": [
                  "userId"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token generated successfully",
            "content": {
              "application/json": {
                "example": {
                  "refreshToken": "eyJhbGciOiJIUzI1NiIsIn..."
                }
              }
            }
          },
          "400": {
            "description": "Missing userId in request body"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Generate new access token using refresh token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": {
                    "type": "string",
                    "example": "44702311"
                  },
                  "refreshToken": {
                    "type": "string",
                    "example": "eyJhbGciOiJIUzI1NiIsIn..."
                  }
                },
                "required": [
                  "userId",
                  "refreshToken"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "example": {
                  "accessToken": "eyJhbGciOiJIUzI1NiIsIn...",
                  "refreshToken": "eyJhbGciOiJIUzI1NiIsIn...",
                  "expiresAt": "2025-09-17T01:23:45.678Z"
                }
              }
            }
          },
          "401": {
            "description": "Invalid refresh token"
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/querytool/pgsql": {
      "post": {
        "tags": [
          "PostgreSQL Database Tool"
        ],
        "summary": "Run custom SQL query on PostgreSQL with pagination",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/XUserIdHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "example": "SELECT * FROM users"
                  },
                  "skip": {
                    "type": "integer",
                    "example": 0
                  },
                  "take": {
                    "type": "integer",
                    "example": 5
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Query executed successfully",
            "content": {
              "application/json": {
                "example": {
                  "db": "pgsql",
                  "skip": 0,
                  "take": 5,
                  "totalCount": 2,
                  "schema": [
                    {
                      "name": "id",
                      "type": "number"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    }
                  ],
                  "data": [
                    {
                      "id": 1,
                      "name": "Alice"
                    },
                    {
                      "id": 2,
                      "name": "Bob"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized, invalid or missing token"
          },
          "500": {
            "description": "Database error"
          }
        }
      }
    },
    "/querytool/mysql": {
      "post": {
        "tags": [
          "MySQL Database Tool"
        ],
        "summary": "Run custom SQL query on MySQL with pagination",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/XUserIdHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "example": "SELECT * FROM users"
                  },
                  "skip": {
                    "type": "integer",
                    "example": 0
                  },
                  "take": {
                    "type": "integer",
                    "example": 5
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Query executed successfully",
            "content": {
              "application/json": {
                "example": {
                  "db": "mysql",
                  "skip": 0,
                  "take": 5,
                  "totalCount": 2,
                  "schema": [
                    {
                      "name": "id",
                      "type": "number"
                    },
                    {
                      "name": "name",
                      "type": "string"
                    }
                  ],
                  "data": [
                    {
                      "id": 1,
                      "name": "Charlie"
                    },
                    {
                      "id": 2,
                      "name": "Diana"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized, invalid or missing token"
          },
          "500": {
            "description": "Database error"
          }
        }
      }
    },
    "/ping": {
      "get": {
        "tags": [
          "WhatsApp Bot"
        ],
        "summary": "Check server status",
        "responses": {
          "200": {
            "description": "Ok",
            "content": {
              "application/json": {
                "example": {
                  "status": "string",
                  "time": "string"
                }
              }
            }
          },
          "500": {
            "description": "Error: Internal Server Error",
            "content": {
              "application/json": {
                "example": {
                  "error": "string"
                }
              }
            }
          }
        }
      }
    },
    "/send-messages": {
      "post": {
        "tags": [
          "WhatsApp Bot"
        ],
        "summary": "Send multiple WhatsApp messages",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "description": "Array pesan teks yang dikirim",
                "items": {
                  "type": "object",
                  "properties": {
                    "jid": {
                      "type": "string",
                      "description": "JID WA tujuan",
                      "example": "628123456789@s.whatsapp.net"
                    },
                    "message": {
                      "type": "string",
                      "description": "Isi pesan teks",
                      "example": "Halo, ini pesan otomatis!"
                    }
                  },
                  "required": [
                    "jid",
                    "message"
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Messages sent result",
            "content": {
              "application/json": {
                "example": {
                  "results": [
                    {
                      "jid": "628123456789@s.whatsapp.net",
                      "status": "success"
                    },
                    {
                      "jid": "68561@s.whatsapp.net",
                      "status": "error",
                      "error": "Nomor tidak terdaftar di WhatsApp"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "example": {
                  "error": "Body harus berupa array pesan"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "example": {
                  "error": "string"
                }
              }
            }
          }
        }
      }
    },
    "/send-images": {
      "post": {
        "tags": [
          "WhatsApp Bot"
        ],
        "summary": "Send images to multiple WhatsApp users",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "description": "Array pesan gambar yang dikirim",
                "items": {
                  "type": "object",
                  "properties": {
                    "jid": {
                      "type": "string",
                      "description": "JID WA tujuan",
                      "example": "628123456789@s.whatsapp.net"
                    },
                    "image": {
                      "type": "string",
                      "description": "Image URL, local path, atau base64 string",
                      "examples": {
                        "url": {
                          "value": "https://example.com/photo.jpg"
                        },
                        "local": {
                          "value": "./uploads/photo.jpg"
                        },
                        "base64": {
                          "value": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
                        }
                      }
                    },
                    "caption": {
                      "type": "string",
                      "description": "Caption opsional untuk gambar",
                      "example": "Ini caption opsional untuk gambar"
                    }
                  },
                  "required": [
                    "jid",
                    "image"
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Images sent result",
            "content": {
              "application/json": {
                "example": {
                  "results": [
                    {
                      "jid": "628123456789@s.whatsapp.net",
                      "status": "success"
                    },
                    {
                      "jid": "628987654321@s.whatsapp.net",
                      "status": "error",
                      "error": "Nomor tidak terdaftar di WhatsApp"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "example": {
                  "error": "Body harus berupa array gambar"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "example": {
                  "error": "string"
                }
              }
            }
          }
        }
      }
    },
    "/send-audios": {
      "post": {
        "tags": [
          "WhatsApp Bot"
        ],
        "summary": "Send audio ke multiple WhatsApp Users",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "description": "Array audio message yang dikirim ke JID tertentu",
                "items": {
                  "type": "object",
                  "properties": {
                    "jid": {
                      "type": "string",
                      "description": "JID WA tujuan",
                      "example": "628123456789@s.whatsapp.net"
                    },
                    "audioUrl": {
                      "type": "string",
                      "description": "URL file audio yang akan dikirim",
                      "example": "https://commondatastorage.googleapis.com/codeskulptor-assets/Evillaugh.ogg"
                    },
                    "ptt": {
                      "type": "boolean",
                      "description": "Apakah dikirim sebagai voice note, default false",
                      "example": false
                    }
                  },
                  "required": [
                    "jid",
                    "audioUrl"
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Hasil pengiriman audio per nomor",
            "content": {
              "application/json": {
                "example": {
                  "results": [
                    {
                      "jid": "628123456789@s.whatsapp.net",
                      "status": "success"
                    },
                    {
                      "jid": "628987654321@s.whatsapp.net",
                      "status": "error",
                      "error": "Nomor tidak terdaftar di WhatsApp"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request, misal body tidak array",
            "content": {
              "application/json": {
                "example": {
                  "error": "Array body dibutuhkan"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error, socket WA belum siap",
            "content": {
              "application/json": {
                "example": {
                  "error": "WhatsApp socket belum siap"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "parameters": {
      "XUserIdHeader": {
        "name": "X-User-Id",
        "in": "header",
        "required": true,
        "schema": {
          "type": "string"
        },
        "description": "User ID yang login"
      }
    }
  }
}